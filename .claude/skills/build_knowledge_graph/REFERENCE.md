# build_knowledge_graph - 详细参考文档

## 📋 工作流SOP详细说明

### 标准执行流程
```
1. 接收文档集合 → 2. 分析构建模式（单文档/多文档） → 3. 提取知识点和实体 → 4. 识别关系和关联 → 5. 构建图谱结构 → 6. 验证图谱完整性 → 7. 返回知识图谱
```

### 详细流程说明

#### 步骤1：接收文档集合
- 验证文档集合的完整性和有效性
- 检查文档格式和内容质量
- 解析构建模式参数（单文档/多文档）
- 记录文档基本信息（数量、类型、大小）

#### 步骤2：分析构建模式（单文档/多文档）
- **单文档模式识别**：当文档数量为1时，自动识别为单文档模式
- **多文档模式识别**：当文档数量大于1时，自动识别为多文档模式
- **模式特征分析**：
  - 单文档模式：关注内部知识结构和学习路径
  - 多文档模式：关注跨文档实体关系和知识关联
- **模式确认**：与用户确认构建模式选择

#### 步骤3：提取知识点和实体
- **单文档模式**：
  - 提取核心概念和定义
  - 识别关键流程和步骤
  - 提取重要知识点
  - 识别学习目标和要求
- **多文档模式**：
  - 识别命名实体（人员、组织、概念等）
  - 提取实体属性和特征
  - 识别实体类型和分类
  - 建立实体候选集合

#### 步骤4：识别关系和关联
- **单文档模式**：
  - 建立层级依赖关系（先修知识→后续知识）
  - 识别概念之间的关联关系
  - 建立流程顺序关系
  - 计算关系强度和置信度
- **多文档模式**：
  - 分析实体共现关系
  - 识别语义关联关系
  - 建立跨文档引用关系
  - 计算关系权重和相关性

#### 步骤5：构建图谱结构
- **节点创建**：
  - 为知识点/实体创建节点
  - 设置节点属性（ID、名称、类型、定义等）
  - 建立节点分类和标签
- **边创建**：
  - 基于识别的关系创建边
  - 设置边属性（类型、强度、方向等）
  - 建立边的权重和置信度
- **图谱结构优化**：
  - 构建邻接矩阵
  - 建立索引和映射
  - 优化存储结构

#### 步骤6：验证图谱完整性
- **结构完整性检查**：
  - 检查节点和边的完整性
  - 验证属性映射的正确性
  - 检查图谱连通性
- **逻辑一致性验证**：
  - 验证关系逻辑的正确性
  - 检查循环引用
  - 验证层级关系的合理性
- **质量评估**：
  - 计算图谱度量指标
  - 评估图谱覆盖度
  - 识别潜在问题

#### 步骤7：返回知识图谱
- **生成标准化数据结构**：
  - 节点列表（包含完整属性）
  - 边列表（包含关系信息）
  - 图谱元数据
- **提供图谱度量指标**：
  - 节点数量、边数量
  - 连通性、覆盖度
  - 其他质量指标
- **返回学习路径**（单文档模式）：
  - 先修知识列表
  - 学习顺序推荐

---

## 🎯 构建模式详解

### 单文档学习路径模式

#### 适用场景
- 培训材料学习路径构建
- 知识体系梳理
- 课程设计
- 个人学习规划

#### 提取内容
- **核心概念**：关键概念和定义
- **重要知识点**：核心知识点和要点
- **流程步骤**：操作流程和步骤
- **学习目标**：学习目标和要求

#### 关系类型
- **先修关系**：知识点之间的先修依赖
- **层级关系**：概念的层级结构
- **关联关系**：相关概念之间的联系
- **流程关系**：流程步骤的顺序关系

#### 输出示例
```json
{
  "knowledge_graph": {
    "nodes": [
      {
        "node_id": "kp_001",
        "type": "knowledge_point",
        "name": "年假基本概念",
        "definition": "员工根据工作年限享有的带薪休假",
        "difficulty": "easy",
        "estimated_learning_time": "15分钟"
      }
    ],
    "edges": [
      {
        "edge_id": "edge_001",
        "from": "kp_001",
        "to": "kp_002",
        "type": "prerequisite",
        "strength": 0.9,
        "description": "理解年假基本概念是学习年假计算规则的前提"
      }
    ]
  },
  "learning_path": {
    "prerequisites": ["kp_001"],
    "learning_sequence": ["kp_001", "kp_002", "kp_003"],
    "estimated_total_time": "2小时"
  }
}
```

### 多文档实体关系模式

#### 适用场景
- 跨文档知识关联分析
- 企业知识网络构建
- 主题知识图谱构建
- 知识发现和数据挖掘

#### 实体类型
- **人员实体**：员工、主管、HR、客户等
- **组织实体**：部门、团队、公司、机构等
- **概念实体**：政策、流程、产品、技术等
- **事件实体**：会议、项目、活动等
- **位置实体**：地点、区域、场所等

#### 关系类型
- **从属关系**：组织层级、汇报关系
- **关联关系**：相关概念、相似主题
- **引用关系**：文档间的引用和参考
- **依赖关系**：流程依赖、业务依赖
- **共现关系**：实体在同一上下文中出现

#### 输出示例
```json
{
  "knowledge_graph": {
    "nodes": [
      {
        "node_id": "ent_001",
        "type": "person",
        "name": "员工",
        "attributes": {
          "category": "角色",
          "description": "企业正式雇佣的工作人员"
        }
      },
      {
        "node_id": "ent_002",
        "type": "concept",
        "name": "年假",
        "attributes": {
          "category": "假期类型",
          "description": "员工根据工作年限享有的带薪休假"
        }
      }
    ],
    "edges": [
      {
        "edge_id": "rel_001",
        "from": "ent_001",
        "to": "ent_002",
        "type": "has_right",
        "strength": 1.0,
        "documents": ["doc_001", "doc_002"],
        "description": "员工享有年假权利"
      }
    ]
  },
  "graph_metrics": {
    "node_count": 45,
    "edge_count": 78,
    "entity_types": {
      "person": 8,
      "concept": 25,
      "organization": 12
    },
    "connectivity": 0.87,
    "coverage_rate": 0.91
  }
}
```

---

## 🔧 高级配置详解

### 实体类型配置
```yaml
entity_types:
  person:
    enabled: true
    attributes: ["name", "role", "department", "level"]
    extract_rules:
      - "员工"
      - "主管"
      - "HR"
      - "经理"
      
  concept:
    enabled: true
    attributes: ["name", "definition", "category", "domain"]
    extract_rules:
      - "政策"
      - "流程"
      - "制度"
      - "规范"
      
  organization:
    enabled: true
    attributes: ["name", "type", "level", "parent"]
    extract_rules:
      - "部门"
      - "团队"
      - "公司"
      - "机构"
```

### 关系识别配置
```yaml
relationship_detection:
  methods:
    co_occurrence:
      enabled: true
      window_size: 50
      min_frequency: 2
      
    semantic_similarity:
      enabled: true
      threshold: 0.7
      model: "bert-base-chinese"
      
    pattern_matching:
      enabled: true
      patterns:
        - "prerequisite": ["前提", "需要先", "基础是"]
        - "related_to": ["相关", "关联", "涉及"]
        - "part_of": ["属于", "包含", "包括"]
```

### 图谱构建配置
```yaml
graph_construction:
  node_creation:
    deduplication: true
    similarity_threshold: 0.85
    merge_strategy: "keep_first"
    
  edge_creation:
    weight_calculation: "normalized"
    confidence_threshold: 0.6
    direction_detection: true
    
  structure_optimization:
    build_adjacency_matrix: true
    create_index: true
    optimize_storage: true
```

---

## ⚠️ 注意事项详解

### 文档质量要求
- **内容完整性**：文档内容要完整，避免碎片化信息
- **格式规范性**：文档格式要规范，便于解析和处理
- **语言清晰性**：语言表达要清晰，避免歧义
- **结构合理性**：文档结构要合理，层次分明

### 构建模式选择
- **单文档模式**：适合构建学习路径和知识体系
- **多文档模式**：适合构建实体关系网络和知识关联
- **混合模式**：结合两种模式的优势，构建综合知识图谱

### 实体识别精度
- **词典支持**：提供领域词典提高识别精度
- **上下文理解**：结合上下文信息提高识别准确性
- **歧义处理**：处理实体名称的歧义问题
- **新词发现**：发现领域新词和专有名词

### 关系抽取质量
- **关系类型定义**：明确定义需要抽取的关系类型
- **抽取规则**：制定清晰的关系抽取规则
- **置信度评估**：评估关系抽取的置信度
- **人工审核**：重要关系建议人工审核确认

---

## 📊 质量验证指标

### 核心指标
- **知识点提取准确率**: ≥88%（目标值）
- **实体识别准确率**: ≥90%（目标值）
- **关系抽取准确率**: ≥85%（目标值）
- **图谱一致性**: ≥92%（目标值）

### 图谱质量指标
- **节点完整性**: ≥95%（目标值）
- **边完整性**: ≥90%（目标值）
- **连通性**: ≥85%（目标值）
- **覆盖度**: ≥87%（目标值）

### 性能指标
- **处理效率**: ≤10秒/千字（目标值）
- **内存使用**: ≤1GB（目标值）
- **可扩展性**: 支持1000+文档处理

---

**文档版本**: v1.0  
**最后更新**: 2025-11-28